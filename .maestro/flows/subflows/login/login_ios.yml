# flow.yaml

appId: tv.brunstad.app
---
- launchApp:
    label: Try clearing already existing state from Safari
    appId: com.apple.mobilesafari
    clearState: false # we cannot clear state for Safari, as that causes Maestro to reinstall the app (which doesn't work for Safari)
    clearKeychain: true
    stopApp: true
- launchApp: tv.brunstad.app
- tapOn:
    label: App optionally asks for network permissions
    text: Allow
    optional: true
- tapOn: "Sign in"
- tapOn:
    label: App asks to open sign-in page in Safari
    text: Continue
    optional: true
- tapOn:
    label: Fields are optional, as there might already be login state in Safari. In that case Safari just closes
    text: Email
    optional: true
- inputText:
    label: Fields are optional, as there might already be login state in Safari. In that case Safari just closes
    text: ${output.env.LOGIN_EMAIL}
    optional: true
- pressKey: Enter
- inputText:
    label: Fields are optional, as there might already be login state in Safari. In that case Safari just closes
    text: ${output.env.LOGIN_PASSWORD}
    optional: true
- pressKey: Enter
- tapOn:
    label: App optionally asks for notification permissions
    text: Accept
    optional: true
- assertVisible: "Home"
- assertVisible: "Search"
- assertVisible: "Signed in"
